<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BMT | Home</title>
  <link rel="stylesheet" href="/resources/css/home.css"/>
  <link rel="stylesheet" href="/resources/css/onboarding.css"/>
  <link rel="icon" href="https://i.ibb.co/RkFt9KR2/App-Logo.png" type="image/png" />
  <script src="/resources/js/dropdown.js" defer></script>
  <link href='https://cdn.boxicons.com/fonts/basic/boxicons.min.css' rel='stylesheet'>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

</head>
<body>

  <!-- Header with brand and menu button -->
  <div class="brand-wrapper">
    <img src="https://i.ibb.co/RkFt9KR2/App-Logo.png" alt="Logo" class="brand-logo" />
    <div class="brand">
      <strong>BEERMASTERTRADING</strong>
      <span>DELIVERY</span>
    </div>
  </div>
  <header>

    <button class="menu-button" onclick="openMenu()"><i class='bx bx-menu' id="toggle-icon"></i></button>
  </header>
  <div class="horizontal-menu">
    <a href="#">Already have account?</a>
    <a href="#">Support</a>
  </div>


  <!-- Full screen sliding side menu -->
  <div id="sideMenu" class="side-menu">
    <button class="close-button" onclick="closeMenu()">âœ•</button>
    <div class="menu-content">
      <a href="#" class="menu-item"><i class='bx bx-home'></i> Home</a>
      <a href="#" class="menu-item"><i class='bx bx-cart'></i> Place Order</a>
      <a href="#" class="menu-item"><i class='bx bx-map'></i> Track Order</a>
      <a href="#" class="menu-item"><i class='bx bx-user-plus'></i> Create Account</a>
      <a href="#" class="menu-item"><i class='bx bx-info-circle'></i> About</a>
      <a href="#" class="menu-item"><i class='bx bx-phone'></i> Contact</a>
    </div>
  </div>

  <!-- Home Content -->
  <section class="onboarding-form-section">
    <h2>Create Your Account</h2>
    <form class="onboarding-form">

      <div class="form-row">
        <div class="form-group">
          <label for="firstName">First Name <span class="required">*</span></label>
          <input type="text" id="firstName" name="firstName" />
          <small class="feedback">Please enter your first name.</small>
        </div>
        <div class="form-group">
          <label for="middleName">Middle Name</label>
          <input type="text" id="middleName" name="middleName" />
          <small class="feedback">Optional field.</small>
        </div>
        <div class="form-group">
          <label for="surname">Surname <span class="required">*</span></label>
          <input type="text" id="surname" name="surname" />
          <small class="feedback">Please enter your last name.</small>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="birthday">Birthday <span class="required">*</span></label>
          <input type="date" id="birthday" name="birthday" />
          <small class="feedback">Select your date of birth.</small>
        </div>
        <div class="form-group">
          <label for="storeName">Store Name <span class="required">*</span></label>
          <input type="text" id="storeName" name="storeName" />
          <small class="feedback">Enter your store or business name.</small>
        </div>
      </div>

      <div class="form-group full-width">
        <label for="email">Email Address <span class="required">*</span></label>
        <input type="email" id="email" name="email" placeholder="your@email.com" />
        <small class="feedback">Please enter a valid email address.</small>
      </div>

      <div class="form-group full-width">
        <label for="phone">Phone Number <span class="required">*</span></label>
        <input type="tel" id="phone" name="phone" placeholder="0912 345 6789" />
        <small class="feedback">Enter a valid Philippine mobile number.</small>
      </div>
      <div class="form-group">
        <label for="province">Province <span class="required">*</span></label>
        <select id="province" name="province">
          <!-- options go here -->
        </select>
        <small class="feedback">Choose your province in Region A4.</small>
      </div>

      <div class="form-group">
        <label for="city">City / Municipality <span class="required">*</span></label>
        <select id="city" name="city">
          <!-- options go here -->
        </select>
        <small class="feedback">Choose your city in Region A4.</small>
      </div>

      <div class="form-group">
        <label for="barangay">Barangay <span class="required">*</span></label>
        <select id="barangay" name="barangay">
          <!-- options go here -->
        </select>
        <small class="feedback">Choose your barangay in the selected city.</small>
      </div>
      <div class="form-group">
        <label for="floor">Floor / Block No.</label>
        <input type="text" id="floor" name="floor" />
        <small class="feedback">Optional: unit, floor, block number.</small>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="street">Street <span class="required">*</span></label>
          <input type="text" id="street" name="street" />
          <small class="feedback">Enter your street name or barangay.</small>
        </div>
      </div>
      <div class="form-group">
        <label for="postal">Postal Code <span class="required">*</span></label>
        <input type="text" id="postal" name="postal" />
        <small class="feedback">Enter your postal/ZIP code (e.g., 1605).</small>
      </div>
    </div>

    <button type="submit" class="cta-button">Submit</button>
  </form>
</section>

<footer class="site-footer">
  <div class="footer-content">
    <div class="footer-logo">
      <img src="https://i.ibb.co/RkFt9KR2/App-Logo.png" alt="BMT Logo">
      <span>Beer Master Trading Inc.</span>
    </div>
    <div class="footer-links">
      <a href="#">About</a>
      <a href="#">Support</a>
      <a href="#">Contact</a>
      <a href="#">Privacy</a>
    </div>
  </div>
  <div class="footer-bottom">
    <p>&copy; 2025 Beer Master Trading Inc. All rights reserved.</p>
  </div>
</footer>

<script>
  const regionCode = "040000000";
  const provinceSelect = document.getElementById("province");
  const citySelect = document.getElementById("city");
  const barangaySelect = document.getElementById("barangay");

  async function loadProvinces() {
    try {
      const res = await fetch('https://psgc.gitlab.io/api/provinces.json');
      if (!res.ok) throw new Error('Failed to fetch provinces');
      const provinces = await res.json();

      const filteredProvinces = provinces.filter(p => p.regionCode && p.regionCode.startsWith(regionCode));

      filteredProvinces.sort((a, b) => a.name.localeCompare(b.name));

      provinceSelect.innerHTML = `<option value="">Select a province</option>`;
      filteredProvinces.forEach(province => {
        const option = document.createElement("option");
        option.value = province.code;
        option.textContent = province.name;
        provinceSelect.appendChild(option);
      });
    } catch (error) {
      console.error("Error loading provinces:", error);
    }
  }

  provinceSelect.addEventListener("change", async () => {
    citySelect.innerHTML = `<option value="">Select a city/municipality</option>`;
    barangaySelect.innerHTML = `<option value="">Select a barangay</option>`;
    barangaySelect.disabled = true;

    const provinceCode = provinceSelect.value;
    if (!provinceCode) {
      citySelect.disabled = true;
      return;
    }
    citySelect.disabled = false;

    try {
      const res = await fetch('https://psgc.gitlab.io/api/cities-municipalities.json');
      if (!res.ok) throw new Error('Failed to fetch cities');
      const cities = await res.json();

      const filteredCities = cities.filter(c => c.provinceCode === provinceCode);
      filteredCities.sort((a, b) => a.name.localeCompare(b.name));

      filteredCities.forEach(city => {
        const option = document.createElement("option");
        option.value = city.code;
        option.textContent = city.name;
        citySelect.appendChild(option);
      });
    } catch (error) {
      console.error("Error loading cities:", error);
    }
  });

  citySelect.addEventListener("change", async () => {
    barangaySelect.innerHTML = `<option value="">Select a barangay</option>`;

    const cityCode = citySelect.value;
    if (!cityCode) {
      barangaySelect.disabled = true;
      return;
    }
    barangaySelect.disabled = false;

    try {
      const res = await fetch('https://psgc.gitlab.io/api/barangays.json');
      if (!res.ok) throw new Error('Failed to fetch barangays');
      const barangays = await res.json();

      const filteredBarangays = barangays.filter(b => b.municipalityCode === cityCode);
      filteredBarangays.sort((a, b) => a.name.localeCompare(b.name));

      filteredBarangays.forEach(barangay => {
        const option = document.createElement("option");
        option.value = barangay.code;
        option.textContent = barangay.name;
        barangaySelect.appendChild(option);
      });
    } catch (error) {
      console.error("Error loading barangays:", error);
    }
  });

  window.addEventListener('DOMContentLoaded', () => {
    loadProvinces();
    citySelect.disabled = true;
    barangaySelect.disabled = true;
  });

</script>
<script>
  document.querySelector('.onboarding-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    // Fields to validate
    const fields = [
      "firstName",
      "surname",
      "birthday",
      "storeName",
      "email",
      "phone",
      "street",
      "province",
      "city",
      "barangay",
      "postal"
    ];

    let isValid = true;

    fields.forEach(id => {
      const input = document.getElementById(id);
      const feedback = input.nextElementSibling;

      // Check if it's a select with empty value or input with blank text
      if (!input.value || input.value.trim() === "") {
        feedback.style.display = "block";
        feedback.style.color = "red";
        input.classList.add("invalid");
        isValid = false;
      } else {
        feedback.style.display = "none";
        input.classList.remove("invalid");
      }
    });

    if (!isValid) {
      alert("Please fill out all required fields.");
      return;
    }

    // Prepare form data
    const formData = {
      firstName: document.getElementById("firstName").value,
      middleName: document.getElementById("middleName").value,
      surname: document.getElementById("surname").value,
      birthday: document.getElementById("birthday").value,
      storeName: document.getElementById("storeName").value,
      email: document.getElementById("email").value,
      phone: document.getElementById("phone").value,
      floor: document.getElementById("floor").value,
      street: document.getElementById("street").value,
      province: document.getElementById("province").selectedOptions[0]?.textContent || "",
      city: document.getElementById("city").selectedOptions[0]?.textContent || "",
      barangay: document.getElementById("barangay").selectedOptions[0]?.textContent || "",
      postal: document.getElementById("postal").value,
    };

    const citySelect = document.getElementById("city");
    const barangaySelect = document.getElementById("barangay");

    try {
      const response = await fetch('https://script.google.com/macros/s/AKfycbwhWy1UHT40Fw8eGnz1VZOgDkQEqWsUPSNeM8Piqhv0yL_7L3JR6jsGeUqBmw_iZ_1f4Q/exec', {
        method: 'POST',
        body: JSON.stringify(formData),
        headers: { 'Content-Type': 'application/json' }
      });

      const result = await response.json();
      if (result.result === "success") {
        alert("Form submitted successfully!");
        document.querySelector('.onboarding-form').reset();
        citySelect.disabled = true;
        barangaySelect.disabled = true;
      } else {
        alert("Failed to submit the form.");
      }
    } catch (error) {
      console.error("Submission error:", error);
      alert("There was an error submitting the form.");
    }
  });
</script>


</body>
</html>